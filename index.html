<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="utf-8">
    <title>A History of Deportation Test Map - </title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="lib/leaflet.css">
    <script src="js/papaparse.min.js"></script>
    <!--<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"> -->
    <!--<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.5.0/chart.min.js" integrity="sha512-asxKqQghC1oBShyhiBwA+YgotaSYKxGP1rcSYTDrB0U6DxwlJjU59B67U8+5/++uFjcuVM8Hh5cokLjZlhm3Vg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.0.0/d3.min.js" integrity="sha512-0x7/VCkKLLt4wnkFqI8Cgv6no+AaS1TDgmHLOoU3hy/WVtYta2J6gnOIHhYYDJlDxPqEqAYLPS4gzVex4mGJLw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/chart.js"></script> 
</head>

<body>
    <h1>A History of US Deportation</h1>
    <div id="map"></div>
        <div class="center">
            <!--<input type="button" value="setData" class="btn" onclick="setData()"> -->
            <!-- <input type="button" value="hide" class="btn" onclick="hide()">
            <input type="button" value="show" class="btn" onclick="show()"> -->
            <input type="button" value="Pause" class="btn" onclick="pause()" />
            <input type="button" value="Play" class="btn" onclick="play()" />
            <!--<input type="button" value="destroy" class="btn" onclick="destroy()"> -->    
        </div>
    <script src="lib/leaflet.js"></script>
    <script src="js/src.js"></script>
    <!-- <script type="text/javascript" src="js/data_config.js"></script> -->
    <script type="text/javascript" src="js/data_new.js"></script>
    <script>
        var lrmap = L.map('map', {zoomControl: false}).setView([0, 10], 3);
		L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', {
	        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',
	        subdomains: 'abcd',
	        maxZoom: 5,
	        minZoom: 3,
            })
            .addTo(lrmap);
        //var data = [{"from":[-95.712891,37.090240],"to":[-102.552788,23.634501],"labels":["United States","Mexico"],"color":"#ff3a31", "value":27118},{"from":[-95.712891,37.090240],"to":[-106.346771,56.130367],"labels":[null,"Canada"],"color":"#ff7e2b","value":1267},{"from":[-95.712891,37.090240],"to":[-88.896530,13.794185],"labels":[null,"El Salvador"],"color":"#ffc726","value":2117},{"from":[-95.712891,37.090240],"to":[-3.435973,55.378052],"labels":[null,"United Kingdom"],"color":"#e9ff20", "value":248},{"from":[-95.712891,37.090240],"to":[-77.32573,18.15246],"labels":[null,"Jamaica"],"color":"#d77681", "value":1044}];
        //var data2=[{"from":[-73.875523,40.781063],"to":[-80.247887,25.792296],"labels":["New York","Miami"],"color":"#d7768a"},{"from":[-73.875523,40.781063],"to":[-118.2705,33.9984],"labels":[null,"Los Angeles"],"color":"#00ccff"},{"from":[-73.875523,40.781063],"to":[-87.724088,41.917846],"labels":[null,"Chicago"],"color":"#ffc726"},{"from":[-73.875523,40.781063],"to":[-71.058437,42.35902],"labels":[null,"Boston"],"color":"#e9ff20"},{"from":[-73.875523,40.781063],"to":[-75.683057,45.42172],"labels":[null,"Ottawa"],"color":"#99ff1b"}];
        //data_im = data_im.map(item => { return {...item, value: parseInt(Math.random()*20)}});
        var migrationLayer = new L.migrationLayer({
            map: lrmap,
            data: data_im,
            pulseRadius:30,
            pulseBorderWidth:2,
            arcWidth:.5,
            arcLabel:false,
            arcLabelFont:'10px sans-serif',
            maxWidth:20
            }
        );
        migrationLayer.addTo(lrmap);
        //function setData(){
        //    migrationLayer.setData(data2);
        //}
        //function hide(){
        //    migrationLayer.hide();
        //}
        //function show(){
        //    migrationLayer.show();
        //}
        function play(){
            migrationLayer.play();
        }
        function pause(){
            migrationLayer.pause();
        }
        //function destroy() {
        //    migrationLayer.destroy();
        //}
    </script>
    <div class="container">
    <div class="year">
        <p class="yr">1993</p>
    </div> 
    </div>
    <div class="container">
		<div class= "topright">
            <p class="top5"><span>Top 5</span></p>
            <div id="leaderboard" class="cellit">
            <script type="text/javascript" src="js/global.js"></script>
		    <script type="text/javascript" src="js/leaderboard.js"></script>
            </div>
        </div>
    </div>

    <div class="container">
            <div class="bottomleft" style="height:20%">
                <canvas id="myChart" width="400" height="200"></canvas>
            </div>
    </div>
    <script type="text/javascript" src="js/time.js"></script> 
    <script>
    //Multi-Line Chart for Regional Deportations
    const path = "data/maptest_regions.csv";
    
    
    //load csv data and convert to json
    d3.csv(path).then(function(datapoints) {
        console.log(datapoints);
            const arr = [];
            for (var i = 0; i < datapoints.length; i++){ 
                arr.push({'name': datapoints[i][0],
                        'color': datapoints[i][27], 
                        'values': Object.entries(datapoints[i]).slice(1,27).map(entry => entry[1])}); 
                        }
                        return { series:arr, 
                                dates: [0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25].map((i) => time[i].date) 
                            }
        console.log(datapoints);
        });

        //setup
        const data3 = {
            labels: name,
            datasets: [{
                label: '# of Deportations',
            }]
        };

        //config
        const config = {
            type: 'line',
            data: data3,
            options: {
                scales: {
                    y: {
                        beginatZero: true
                    }
                }
            }
        };
        
        // render init block
        //const myChart = new Chart(
        //    document.getElementById('myChart'),
        //    config
        //);
 
    </script>


  </body>
</html>